---
title: "STAT 850 Report"
author: "Paulus Hermanto, Andrew Ker, Bipin Poudel"
date: "2022-11-18"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Introduction
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load in the data
footballgames <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/games.csv')
```


# Data
The data was originally gathered by Pro Football Reference. The data was stored in NFL Scores Main Page under All Game
Scores ([data](https://www.pro-football-reference.com/boxscores/game-scores.htm)). The data was
used for a tidytuesday project in 2020
([data](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-04/readme.md#gamescsv)) that 
primarily focused on NFL attendance. The data used for this report was found using the tidytuesday link.

This data originally contained 19 variables related to NFL game scores and outcomes. Out of these 19 variables, 11
were character variables, seven were numeric variables, and one was a time variable. In order to meet project
specifications, a categorical variable was needed. To derive a categorical variable, a loop was utilized to replace
values of "NA" with a string "0" in the tie column and replace team names with a string "1". This also helped to clean
the data, since it does not make sense to list a team winner for a game that ended with a tie. After this loop, the
strings of "0" and "1" were converted to a categorical variable. This process essentially created a categorical
variable with a value of 0 if an NFL game ended with one team winning and a value of 1 if an NFL game ended in a tie.
The code for deriving this variable is shown below.

```{r, echo = TRUE, results = 'hide'}
##### derive categorical variable #####
# replace NA's in tie column with string 0
footballgames$tie[is.na(footballgames$tie)] <- "0"
# replace ties with string 1 instead of string with team name
for(i in 1:5324){
  if(footballgames$tie[i] != "0"){
    footballgames$tie[i] <- "1"
    i < i+1
  }
  else{
    i <- i+1
  }
}

# treat tie as categorical
footballgames$tie <- as.factor(footballgames$tie)


# get structure to check if tie is not a factor
str(footballgames)

footballgames
```

After deriving the categorical variable, additional data cleaning was needed. The "winner" variable contains the name
of the winning team; however, this still contained the name of the "winning" team even if the game ended in a tie. To 
clean this, another loop was utilized to replace the winning team's name with "tie" in the "winner" column, if the 
game ended in a tie. The code for this is shown below.

```{r, echo = TRUE, results = 'hide'}
# replace ties with string 1 instead of string with team name
for(i in 1:5324){
  if(footballgames$tie[i] == 1){
    footballgames$winner[i] <- "Tie"
    i < i+1
  }
  else{
    i <- i+1
  }
}

footballgames
```


Once the data was cleaned, it still had 19 variables, but with 10 character variables, seven numeric variables, one
time variable, and one categorical variable. For more information about the data, please refer to the table below,
which contains a list of variables, their descriptions, and their types.

Variable Name | Variable Description | Variable Type
------------- | -------------------- | -------------
year | The year in which the game was played | numeric
week | The week of the season in which the game was played | character
home_team | name of the team playing at their home stadium | character
away_team | name of the team playing at visiting stadium | character
winner | name of the winning team | character
tie | indicates whether the game ended in a tie or not | categorical
day | day of the week the game was played on | character
date | date the game was played on | character
time | time of the day when the game started | time
pts_win | points scored by the winning team | numeric
pts_loss | points scored by the losing team | numeric
yds_win | yards gained by the winning team | numeric
turnovers_win | turnovers committed by the winning team | numeric
yds_loss | yards gained by the losing team | numeric
turnovers_loss | turnovers committed by the losing team | numeric
home_team_name | name of the team playing at their home stadium | character
home_team_city | name of the home team's city | character
away_team_name | name of the team playing at visiting stadium | character
away_team_city | name of the away team's city | character

# Exploratory Data Analysis

structure of the data
summary statistics
plots of summary statistics

# Analysis

#### What does number of wins trend looks like for a selected team?

```{r}
library(tidyverse)
library(magrittr)
library(dplyr)
library(ggplot2)
library(plotly)

# Interactive line plots for the number of wins for selected teams
a=footballgames %>% group_by(year) %>%  count(winner)
b = subset(a, winner== "Baltimore Ravens"|winner=="Chicago Bears"|winner=="Denver Broncos"|winner=="Miami Dolphins"|winner=="New England Patriots")

plot1<- ggplot(data= b, aes(year, n))+geom_line(aes(color=winner))+ xlab("Year")+ylab("Number of wins")+ggtitle("Number of games won by selected teams each year")

ggplotly(plot1)

```

#### Is there any relation between points won vs yards won for some selected teams?

```{r}
#Interactive scatterplot of points won vs yards won for selected teams
m= subset(footballgames, winner== "Baltimore Ravens"|winner=="Chicago Bears"|winner=="Denver Broncos"|winner=="Miami Dolphins"|winner=="New England Patriots")

plot2<-ggplot(data= m)+ geom_point(aes(pts_win, yds_win,color= winner)) +xlab("Points Won")+ ylab("Yards Win")

ggplotly(plot2)
```

#### Is there an Advantage to Playing at Home?

It's a common belief that playing any sport (including football) at home stadiums gives the home team an advantage
over the visiting team. The results below aim to assess this belief. First, the number of games won by the home team and the number of games won by the road team are tallied. Based off this tally, there were 3,045 NFL games won by the
home team from 2000-2019. Over this same stretch of time, there were 2,279 NFL games won by the away team. Clearly, 
the home team wins more often than the road team, but it is helpful to provide additional context. Since there were
5,324 games played, the home team has won 3,045/5,324 games for a percentage of 57%. This suggests that the home team
wins NFL games about 57% of the time. It must be noted however, that these counts are not exact since the data lists
a home team, even for games played at a neutral site.
```{r, echo = FALSE, warning=FALSE}
### Comparing the number of games won by the home team to the number of games won by the away team ###

# create a vector of 0's
locationofwin <- rep(c(0), 5324)

# add vector of 0's to the data 
footballgames <- cbind(footballgames, locationofwin)

# for loop to assign values of 1 if the home team won the game
# values of 0 if the home team did not win the game
for(i in 1:5324){
  if(footballgames$winner[i] == footballgames$home_team[i]){
    footballgames$locationofwin[i] <- 1
    i < i+1
  }
  else{
    i <- i+1
  }
}

# count the number of wins by the home team and the number of losses/ties by the home team
table(footballgames$locationofwin)
# 3045
# 2279

# convert locationofwin to categorical
footballgames$locationofwin <- as.factor(footballgames$locationofwin)

# bar plot of games won by home team and games won by away team
footballgames %>%
  ggplot(aes(x = locationofwin, fill = locationofwin)) + 
  geom_bar() + 
  geom_text(stat='count', aes(label=..count..), vjust=0) + 
  ggtitle("Comparing Games Won by Away Teams to Games Won by the Home Team") +
    scale_fill_discrete(labels=c('Away Team Won', 'Home Team Won')) 

```


#### What does the win percentage at home looks like for AFC vs NFC teams?
```{r}
library(dplyr)

#AFC vs NFC teams list
afc_teams<- c("Cleveland Browns","Baltimore Ravens","Pittsburgh Steelers","Cincinnati Bengals","Miami Dolphins","Buffalo Bills","New York Jets","New England Patriots", "Kansas City Chiefs","Los Angeles Chargers","Denver Broncos","Las Vegas Raiders","Tennessee Titans","Houston Texans","Indianapolis Colts","Jacksonville Jaguars")

nfc_teams<-c("Minnesota Vikings","Chicago Bears","Detroit Lions","Green Bay Packers","New York Giants","Dallas Cowboys","Washington Redskins","Philadelphia Eagles","Arizona Cardinals","Los Angeles Rams","Seatlle Seahawks","San Franscisco 49ers","Atlanta Falcons","Tampa Bay","Carolina Panthers ","New Orlean Saints") 

#Created a new column in original dataset called 'divison' the teams play in. 
for(i in 1:5324){
  if(footballgames$home_team[i] %in% afc_teams){
    footballgames$divison[i]<- "AFC"
    
  }
  else{
    footballgames$divison[i]<- "NFC"
    
  }
}

#Percentage of game won at home by NFC teams whenever they played AFC teams.
###First create a data with home team being NFC team and away team being AFC team. 
homewin_nfc<-filter(footballgames, footballgames$home_team %in% nfc_teams & footballgames$away_team %in% afc_teams )

###To find out which divison won when NFC played at home. 
for(i in 1:364){
  if(homewin_nfc$winner[i]%in% afc_teams){
     homewin_nfc$win_div[i]<-"AFC_Win"
     }
  else{
    homewin_nfc$win_div[i]<-"NFC_Win"  
    }
}

#Calculate the percentage of game won by NFC team at home.
(table(homewin_nfc$win_div)/364)*100

#NFC_Win = 55.5%
#AFC_Win = 44.5%

#Percentage of game won at home by AFC teams whenever they played NFC teams.

homewin_afc<-filter(footballgames, footballgames$home_team %in% afc_teams & footballgames$away_team %in% nfc_teams )

###To find out which divison won when AFC played at home. 
for(i in 1:364){
  if(homewin_afc$winner[i]%in% afc_teams){
     homewin_afc$win_div[i]<-"AFC_Win"
     }
  else{
    homewin_afc$win_div[i]<-"NFC_Win"  
    }
}

#Calculate the percentage of game won by NFC team at home.
(table(homewin_afc$win_div)/364)*100

#AFC_Win = 62.0%
#NFC_Win = 38.0%
```

# Conclusion

# Future Ideas

# References